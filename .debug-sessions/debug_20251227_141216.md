# Debug Report
**Session:** 20251227_141216
**Started:** 2025-12-27 14:12:16
**Issue:** Admin user search returns "Failed to load users" error

---

## Investigation Log

1. Found error message in `frontend/src/components/admin/AdminUsers.jsx:72`
2. Traced API call to `GET /api/admin/users` with search parameter
3. Discovered TWO endpoints registered for the same route:
   - `backend/routes/admin_core.py:88-174` (registered FIRST)
   - `backend/routes/admin/user_management.py:45-143` (registered SECOND)

## Root Cause

**Location:** `backend/routes/admin_core.py:111`

**Problem:** The admin_core.py `/api/admin/users` endpoint was searching for a non-existent column:
```python
query = query.or_(f"first_name.ilike.%{search}%,last_name.ilike.%{search}%,username.ilike.%{search}%")
```

The `username` column does NOT exist in the users table. The correct columns are:
- `first_name`
- `last_name`
- `email`
- `display_name`

**Cause:**
1. Duplicate endpoint: Two Flask blueprints both defined `/api/admin/users` GET route
2. Flask routes to first-registered blueprint, which was admin_core.bp
3. admin_core.py had incorrect search query referencing non-existent `username` column
4. Database error caused by invalid column reference resulted in catch-all exception returning "Failed to load users"

The correct implementation in `user_management.py` searches `first_name`, `last_name`, and `email`.

## Fix Applied

**Files Changed:**
- `backend/routes/admin_core.py`

**Changes:**
Removed the duplicate `/users` GET endpoint from admin_core.py (lines 88-174). The correct implementation in `routes/admin/user_management.py` will now handle all `/api/admin/users` requests.

The user_management.py implementation:
1. Uses `@require_advisor` decorator (allows both advisors and admins)
2. Searches correct fields: `first_name`, `last_name`, `email`
3. Supports advisor-specific filtering (assigned students only)
4. Has proper pagination and error handling

## Verification

- admin_core.py loads successfully after removal
- user_management.py continues to load successfully
- No syntax errors introduced

## Status: FIXED

---
**Completed:** 2025-12-27
